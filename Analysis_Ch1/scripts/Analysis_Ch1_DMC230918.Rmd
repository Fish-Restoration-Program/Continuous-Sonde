---
title: "Analyses for Ch1 of Big Report"
author: "DMC"
date: "2023-09-18"
---

Here is the final script to the analyses for Chapter 1.

```{r import FRP data}
rm(list = ls())
load(here::here("imports", "QCd_Data_FRP.RData"))

# create a new list of qc'd data frames to be filtered by year
list_all <- list_all_qc

for(i in 1:length(list_all_qc)){
  #list_2022 <- list() # temporary list
  for(j in 1:length(list_all_qc[[i]])){
    
    rtd_sondeID <- strsplit(names(list_all_qc[[i]])[j], split = " ", fixed = TRUE)[[1]][1] # variable for sondeID
    rtd_dateDeploy <- as.numeric(substr(strsplit(names(list_all_qc[[i]])[j], split = " ", fixed = TRUE)[[1]][2],0,4)) # variable for Deployment date
    rtd_dateRecov <- as.numeric(substr(strsplit(names(list_all_qc[[i]])[j], split = " ", fixed = TRUE)[[1]][3],0,4)) # variable for Recovery date                              0)
    if((rtd_dateDeploy >= 2023 & rtd_dateRecov >= 2023)){
      list_all[[i]][[j]] <- list(NULL)
    } else {
      skip_to_next <- FALSE
      tryCatch({
      list_all[[i]][[j]] <- list_all_qc[[i]][[j]][,c("Site","dts","TempC","SPC","DOmgL","Turb","TempC_qcE","SPC_qcE","DOmgL_qcE","Turb_qcE","Depthm")]
      },
      error = function(e){ skip_to_next <<- TRUE})
      if(skip_to_next) {next}
    }
    rm(rtd_sondeID, rtd_dateDeploy, rtd_dateRecov)
  # when an error is encountered, the loop will be forced to continue and the warning(s) will be shown at the end
  }
}



FLYW <- do.call(rbind.data.frame, list_all[[1]])
FLYW$dts2 <- lubridate::floor_date(FLYW$dts, "15 minutes")
DECK_pool <- do.call(rbind.data.frame, list_all[[2]])
DECK_pool$dts2 <- lubridate::floor_date(DECK_pool$dts, "15 minutes")
DECK_breach <- do.call(rbind.data.frame, list_all[[3]])
DECK_breach$dts2 <- lubridate::floor_date(DECK_breach$dts, "15 minutes")

save(DECK_breach, DECK_pool, FLYW, file = here::here("working","ImportedRaw.RData"))
```


```{r get 1 file for FRP DECK}
library(ggplot2)

rm(list = ls())

load(here::here("working","ImportedRaw.RData"))
'%ni%' = Negate('%in%')

DECK_breach.2 <- DECK_breach[which(DECK_breach$dts2 %ni% DECK_pool$dts2),]
DECK_pool$TempC <- as.numeric(DECK_pool$TempC)
DECK_breach.2$TempC <- as.numeric(DECK_breach.2$TempC)

plo <- ggplot(DECK_pool, aes(x = dts2, y = TempC)) +
  geom_point(color = "black", alpha = 0.2) +
  geom_point(data = DECK_breach.2, aes(x = dts2, y = TempC), color = "red", alpha = 0.2)

DECK <- rbind.data.frame(DECK_pool, DECK_breach.2)

save(DECK, FLYW, file = here::here("working","FRP_Raw.RData"))
```


```{r}
library(ggplot2)
rm(list = ls())
load(here::here("working","FRP_Raw.RData"))

FLYW$TempC <- as.numeric(FLYW$TempC)

dupFLYW <- FLYW[duplicated(FLYW$dts2),]
dupDECK <- DECK[duplicated(DECK$dts2),]

FLYW.2 <- FLYW[-duplicated(FLYW$dts2),]
DECK.2 <- DECK[-duplicated(DECK$dts2),]

FLYW.3 <- FLYW.2[-which(is.na(FLYW.2$dts2)==T),]
DECK.3 <- DECK.2[-which(is.na(DECK.2$dts2)==T | DECK.2$TempC < 0.9),]

DECK.3$Temp_Resto <- DECK.3$TempC

load(here::here("working","USGS_DeckerTogether.Rds"))
USGS_DECK.2$Temp_Ref <- USGS_DECK.2$tempC
USGS_DECK.2$dts2 <- USGS_DECK.2$dateTime

DECK_all <- merge(DECK.3[,c("dts2","Temp_Resto")], USGS_DECK.2[,c("dts2","Temp_Ref")])
DECK_all$diffTemp <- DECK_all$Temp_Resto - DECK_all$Temp_Ref

plo <- ggplot(DECK_all, aes(x = dts2, y = diffTemp)) +
  geom_point()

load(here::here("working","USGS_ToeDrain.RData"))
df_ToeDrain$Temp_Ref <- df_ToeDrain$tempC
df_ToeDrain$dts2 <- df_ToeDrain$dateTime

FLYW.3$Temp_Resto <- as.numeric(FLYW.3$TempC)

FLYW_all <- merge(FLYW.3[,c("dts2","Temp_Resto")], df_ToeDrain[,c("dts2","Temp_Ref")])
FLYW_all$diffTemp <- FLYW_all$Temp_Resto - FLYW_all$Temp_Ref

plo <- ggplot(FLYW_all, aes(x = dts2, y = diffTemp)) +
  geom_point()
```


